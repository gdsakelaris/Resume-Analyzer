<!DOCTYPE html>
<html lang="en" class="h-full bg-slate-50">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Starscreen - Home</title>
        <link rel="icon" type="image/png" href="/images/Logo.png">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">

        <script src="https://cdn.tailwindcss.com"></script>

        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: { sans: ['Inter', 'sans-serif'] },
                        colors: {
                            brand: {
                                50: '#f5f3ff',  // Very light violet (Backgrounds)
                                100: '#ede9fe', // Light violet (Hover states)
                                500: '#8b5cf6', // VIBRANT VIOLET (Main brand color - matches logo)
                                600: '#7c3aed', // Darker violet (Hover interaction)
                                700: '#6d28d9', // Deep violet (Active states)
                                900: '#4c1d95', // Deep purple (Text/Borders)
                            }
                        }
                    }
                }
            }
        </script>

        <script src="/static/auth.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

        <!-- Pre-render authentication and verification check to prevent dashboard flash -->
        <script>
            // Check authentication and verification BEFORE rendering the page
            (function() {
                const token = localStorage.getItem('starscreen_access_token');
                if (!token) {
                    // No token - redirect immediately before page renders
                    window.location.href = '/static/login.html';
                    return;
                }

                // Check if user is verified
                const userJson = localStorage.getItem('starscreen_user');
                if (userJson) {
                    const user = JSON.parse(userJson);
                    if (!user.is_verified) {
                        // Not verified - redirect to verification page
                        window.location.href = '/static/verify-email.html';
                        return;
                    }
                }
            })();
        </script>

        <style>
            [x-cloak] {
                display: none !important;
            }

            /* Hide scrollbar while maintaining scroll functionality */
            .scrollbar-hide {
                -ms-overflow-style: none;  /* Internet Explorer 10+ */
                scrollbar-width: none;  /* Firefox */
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;  /* Safari and Chrome */
            }

            /* Hide body until auth check completes */
            body.auth-checking {
                opacity: 0;
            }
        </style>
    </head>
    <body class="h-full flex flex-col antialiased text-slate-900 auth-checking">

        <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <a href="/" class="flex items-center gap-1 hover:opacity-80 transition cursor-pointer">
                        <img src="/images/Logo.png" alt="Starscreen Logo" class="w-10 h-10">
                        <span class="font-bold text-xl tracking-tight text-slate-800">Starscreen</span>
                    </a>
                    <div class="flex items-center gap-3" x-data="{ userMenuOpen: false, isAdmin: false, ...subscriptionStatus() }" x-init="loadSubscription(); isAdmin = Auth.getUser()?.is_admin || false">
                        <template x-if="isAdmin">
                            <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full font-semibold">ADMIN</span>
                        </template>
                        <span class="text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full border border-slate-200">
                            v1.0 • Connected
                        </span>

                        <!-- User Dropdown Menu -->
                        <div class="relative" @click.away="userMenuOpen = false">
                            <button @click="userMenuOpen = !userMenuOpen"
                                    class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 transition">
                                <!-- Hamburger Icon (3 horizontal lines) -->
                                <svg class="w-6 h-6 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                                <svg class="w-4 h-4 text-slate-500 transition-transform" :class="userMenuOpen ? 'rotate-180' : ''"
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>

                            <!-- Dropdown Menu -->
                            <div x-show="userMenuOpen"
                                 x-cloak
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="opacity-0 scale-95"
                                 x-transition:enter-end="opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="opacity-100 scale-100"
                                 x-transition:leave-end="opacity-0 scale-95"
                                 class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-slate-200 py-2 z-50">

                                <!-- Subscription Info -->
                                <template x-if="subscription">
                                    <div class="px-4 py-3 border-b border-slate-200">
                                        <div class="flex items-center justify-between mb-3">
                                            <span class="text-xs font-medium text-slate-500 uppercase">Subscription</span>
                                            <span class="text-sm px-2.5 py-1 rounded-full border font-medium"
                                                  :class="subscription.plan === 'free' ? 'bg-slate-100 border-slate-300 text-slate-700' : 'bg-brand-50 border-brand-300 text-brand-700'"
                                                  x-text="subscription.plan_display"></span>
                                        </div>

                                        <!-- Usage Bar (if not unlimited) -->
                                        <template x-if="subscription.monthly_candidate_limit < 900000">
                                            <div>
                                                <div class="flex justify-between items-baseline mb-1">
                                                    <span class="text-xs text-slate-600">Candidates this month</span>
                                                    <span class="text-sm font-bold text-slate-900" x-text="`${subscription.remaining_candidates} left`"></span>
                                                </div>
                                                <div class="w-full bg-slate-200 rounded-full h-2 mb-1">
                                                    <div class="h-2 rounded-full transition-all"
                                                         :class="{
                                                             'bg-red-500': subscription.usage_percentage >= 90,
                                                             'bg-yellow-500': subscription.usage_percentage >= 70 && subscription.usage_percentage < 90,
                                                             'bg-green-500': subscription.usage_percentage < 70
                                                         }"
                                                         :style="`width: ${subscription.usage_percentage}%`"></div>
                                                </div>
                                                <div class="flex justify-between text-xs text-slate-500">
                                                    <span x-text="`${subscription.candidates_used_this_month} used`"></span>
                                                    <span x-text="`${subscription.monthly_candidate_limit} total`"></span>
                                                </div>
                                                <template x-if="subscription.usage_percentage < 90 && subscription.current_period_end">
                                                    <p class="text-xs text-slate-500 mt-2">
                                                        Resets <span x-text="new Date(subscription.current_period_end).toLocaleDateString()"></span>
                                                    </p>
                                                </template>
                                                <template x-if="subscription.usage_percentage >= 90">
                                                    <p class="text-xs text-red-600 font-medium mt-2">
                                                        ⚠️ Almost at limit! Consider upgrading.
                                                    </p>
                                                </template>
                                            </div>
                                        </template>

                                        <!-- Unlimited Badge -->
                                        <template x-if="subscription.monthly_candidate_limit >= 900000">
                                            <div class="flex items-center justify-center py-2">
                                                <div class="text-sm bg-gradient-to-r from-brand-500 to-purple-500 text-white px-4 py-2 rounded-full border border-brand-400 font-semibold">
                                                    ∞ Unlimited Candidates
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </template>

                                <!-- Menu Items -->
                                <div class="py-1">
                                    <a href="/"
                                       class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                        </svg>
                                        Dashboard
                                    </a>
                                    <a href="/static/pricing.html"
                                       class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                        </svg>
                                        Manage Billing
                                    </a>
                                    <!-- Cancel Subscription (only show if user has paid plan) -->
                                    <template x-if="subscription && subscription.plan !== 'free'">
                                        <button @click="cancelSubscription()"
                                                class="w-full flex items-center gap-3 px-4 py-2 text-sm text-orange-600 hover:bg-orange-50">
                                            <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                            Cancel Subscription
                                        </button>
                                    </template>
                                    <a href="/static/privacy.html"
                                       class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                        </svg>
                                        Privacy Policy
                                    </a>
                                    <a href="/static/terms.html"
                                       class="flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        Terms of Service
                                    </a>
                                    <button @click="deleteAccount()"
                                            class="w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                        <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                        Delete Account
                                    </button>
                                </div>

                                <!-- Logout -->
                                <div class="border-t border-slate-200 pt-1">
                                    <button onclick="Auth.logout()"
                                            class="w-full flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50">
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8" x-data="app()">

            <div x-show="toast.visible" x-transition
                class="fixed top-20 right-5 z-50 flex items-center w-full max-w-xs p-4 space-x-3 text-slate-500 bg-white rounded-lg shadow-xl border-l-4"
                :class="toast.type === 'error' ? 'border-red-500' : 'border-brand-500'" x-cloak>
                <div class="text-sm font-medium" x-text="toast.message"></div>
            </div>

            <div class="grid grid-cols-12 gap-8 h-[calc(100vh-8rem)]">

                <div class="col-span-12 lg:col-span-4 flex flex-col gap-4 h-full">

                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-semibold text-slate-800">Positions</h2>
                        <button @click="showCreateModal = true"
                            class="text-sm bg-gradient-to-r from-cyan-500 to-violet-600 hover:from-cyan-600 hover:to-violet-700 text-white py-2 px-4 rounded-md font-medium transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                            <span>+ New Job</span>
                        </button>
                    </div>

                    <div
                        class="bg-white rounded-xl shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] border border-slate-100 flex-1 overflow-hidden flex flex-col max-h-[calc(100vh-12rem)]">
                        <div class="overflow-y-auto p-2 space-y-2 flex-1 scrollbar-hide min-h-0">

                            <template x-if="jobs.length === 0">
                                <div class="text-center py-10 px-4">
                                    <div class="text-slate-300 mb-2">
                                        <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                                            </path>
                                        </svg>
                                    </div>
                                    <h3 class="text-sm font-medium text-slate-900">No jobs found</h3>
                                    <p class="text-xs text-slate-500 mt-1">Create a new position to get started.</p>
                                </div>
                            </template>

                            <template x-for="job in jobs" :key="job.id">
                                <div @click.self="selectJob(job)"
                                    class="group cursor-pointer p-4 rounded-lg transition-all duration-200 border border-transparent hover:border-brand-200 hover:shadow-md relative"
                                    :class="selectedJob?.id === job.id ? 'bg-brand-50 border-brand-200 ring-1 ring-brand-200' : 'bg-white hover:bg-slate-50'">
                                    <div class="flex justify-between items-start mb-1">
                                        <h3 @click="selectJob(job)"
                                            class="font-semibold text-slate-900 group-hover:text-brand-700 transition-colors flex-1"
                                            x-text="job.title"></h3>
                                        <div class="flex items-center gap-2">
                                            <span x-show="job.status !== 'COMPLETED'"
                                                class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                                                :class="{
                                                  'bg-yellow-100 text-yellow-800': job.status === 'PENDING',
                                                  'bg-blue-100 text-blue-800': job.status === 'PROCESSING',
                                                  'bg-red-100 text-red-800': job.status === 'FAILED'
                                              }" x-text="job.status"></span>
                                            <!-- 3-dot menu button -->
                                            <button
                                                @click.stop="openJobMenuId = openJobMenuId === job.id ? null : job.id"
                                                class="p-1 rounded hover:bg-slate-200 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <svg class="w-5 h-5 text-slate-600" fill="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path
                                                        d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                                                </svg>
                                            </button>
                                        </div>

                                        <!-- Context menu dropdown -->
                                        <div x-show="openJobMenuId === job.id" @click.outside="openJobMenuId = null"
                                            class="absolute right-4 top-12 w-48 bg-white rounded-lg shadow-lg border py-1 z-10">
                                            <button @click.stop="viewJobDescription(job); openJobMenuId = null"
                                                class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                                    </path>
                                                </svg>
                                                View Description
                                            </button>
                                            <button @click.stop="editJob(job); openJobMenuId = null"
                                                class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                                    </path>
                                                </svg>
                                                Edit
                                            </button>
                                            <div class="border-t border-slate-200 my-1"></div>
                                            <button @click.stop="openDeleteJobModal(job); openJobMenuId = null"
                                                class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                                    </path>
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                    <p @click="selectJob(job)" class="text-xs text-slate-500 line-clamp-2"
                                        x-text="job.description"></p>
                                    <div @click="selectJob(job)"
                                        class="mt-3 flex items-center gap-2 text-xs text-slate-400">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span x-text="new Date(job.created_at).toLocaleDateString()"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <div class="col-span-12 lg:col-span-8 h-full flex flex-col">

                    <div x-show="!selectedJob"
                        class="h-full flex flex-col items-center justify-center text-center p-8 bg-white rounded-xl shadow-sm border border-slate-100 border-dashed">
                        <div class="w-16 h-16 bg-brand-50 rounded-full flex items-center justify-center mb-4">
                            <svg class="w-8 h-8 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122">
                                </path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-slate-900">Select a Job</h3>
                        <p class="text-slate-500 max-w-sm mt-2">Click on a position from the left sidebar to view
                            candidates, upload resumes, and see AI insights.</p>
                    </div>

                    <div x-show="selectedJob" class="h-full flex flex-col gap-6" x-cloak>

                        <div class="grid grid-cols-2 gap-4">
                            <div
                                class="bg-white p-5 rounded-xl border border-slate-100 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)]">
                                <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Total
                                    Candidates</p>
                                <p class="text-3xl font-bold text-slate-900 mt-1" x-text="candidates.length"></p>
                            </div>
                            <div
                                class="bg-white p-5 rounded-xl border border-slate-100 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)]">
                                <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider">AI Screened</p>
                                <p class="text-3xl font-bold text-brand-600 mt-1"
                                    x-text="candidates.filter(c => c.status === 'SCORED').length"></p>
                            </div>
                        </div>

                        <!-- Status Legend (Mobile Only) -->
                        <div class="md:hidden bg-white rounded-lg border border-slate-100 p-3 mb-4">
                            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Status Legend</p>
                            <div class="flex flex-wrap gap-3 text-xs">
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2.5 h-2.5 rounded-full bg-slate-400"></span>
                                    <span class="text-slate-600">Uploaded</span>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2.5 h-2.5 rounded-full bg-blue-500"></span>
                                    <span class="text-slate-600">Processing</span>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2.5 h-2.5 rounded-full bg-purple-500"></span>
                                    <span class="text-slate-600">Parsed</span>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2.5 h-2.5 rounded-full bg-green-500"></span>
                                    <span class="text-slate-600">Scored</span>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span>
                                    <span class="text-slate-600">Failed</span>
                                </div>
                            </div>
                        </div>

                        <div
                            class="bg-white rounded-xl shadow-[0_4px_20px_-4px_rgba(6,81,237,0.1)] border border-slate-100 flex-1 flex flex-col overflow-hidden max-h-[calc(100vh-12rem)]">

                            <div class="border-b border-slate-100 px-6 flex gap-6">
                                <button
                                    class="py-4 text-sm font-medium border-b-2 border-brand-500 text-brand-600">Candidates</button>
                            </div>

                            <div class="flex-1 flex flex-col p-6 overflow-hidden">

                                <div class="mb-6 flex gap-4">
                                    <label
                                        class="flex-1 group relative flex flex-col items-center justify-center p-6 bg-cyan-500 hover:bg-cyan-600 rounded-xl transition-all cursor-pointer shadow-md hover:shadow-lg">
                                        <div class="text-center">
                                            <svg class="mx-auto h-8 w-8 text-white" fill="none" viewBox="0 0 24 24"
                                                stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                            </svg>
                                            <p class="mt-2 text-sm text-white font-medium">Upload Resumes</p>
                                        </div>
                                        <input type="file" class="hidden" accept=".pdf,.doc,.docx" multiple
                                            @change="uploadFile($event, 'single')">
                                    </label>

                                    <label
                                        class="flex-1 group relative flex flex-col items-center justify-center p-6 bg-cyan-500 hover:bg-cyan-600 rounded-xl transition-all cursor-pointer shadow-md hover:shadow-lg">
                                        <div class="text-center">
                                            <svg class="mx-auto h-8 w-8 text-white" fill="none" viewBox="0 0 24 24"
                                                stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                            </svg>
                                            <p class="mt-2 text-sm text-white font-medium">Batch ZIP Upload</p>
                                        </div>
                                        <input type="file" class="hidden" accept=".zip"
                                            @change="uploadFile($event, 'bulk')">
                                    </label>

                                </div>

                                <div x-show="selectedCandidates.length > 0"
                                    class="mb-4 px-4 py-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between">
                                    <div class="flex items-center gap-2 text-sm text-blue-900">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span><span x-text="selectedCandidates.length"></span> candidate<span
                                                x-show="selectedCandidates.length > 1">s</span> selected</span>
                                    </div>
                                    <button @click="deleteSelectedCandidates()"
                                        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                        Delete Selected
                                    </button>
                                </div>

                                <div
                                    class="grid grid-cols-12 gap-4 px-4 py-2 bg-slate-50 rounded-lg text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">
                                    <div class="col-span-1 flex items-center justify-center">
                                        <input type="checkbox"
                                            class="w-4 h-4 text-brand-600 bg-white border-slate-300 rounded focus:ring-brand-500 focus:ring-2 cursor-pointer"
                                            @change="toggleSelectAll($event)"
                                            :checked="selectedCandidates.length > 0 && selectedCandidates.length === candidates.length">
                                    </div>
                                    <div class="col-span-6">Candidate</div>
                                    <div class="col-span-2">Status</div>
                                    <div class="col-span-2 text-right">Added</div>
                                    <div class="col-span-1"></div>
                                </div>

                                <div class="overflow-y-auto flex-1 scrollbar-hide space-y-1 min-h-0">
                                    <template x-if="candidates.length === 0">
                                        <div class="text-center py-8 text-slate-400 text-sm">No candidates yet. Upload
                                            resumes to begin.</div>
                                    </template>

                                    <template x-for="c in candidates" :key="c.id">
                                        <div class="grid grid-cols-12 gap-4 px-4 py-3 items-center border-b border-slate-50 hover:bg-slate-50 transition-colors rounded-lg group"
                                            x-data="{ menuOpen: false }">
                                            <div class="col-span-1 flex items-center justify-center">
                                                <input type="checkbox"
                                                    class="w-4 h-4 text-brand-600 bg-white border-slate-300 rounded focus:ring-brand-500 focus:ring-2 cursor-pointer"
                                                    :checked="selectedCandidates.includes(c.id)"
                                                    @change="toggleCandidate(c.id)">
                                            </div>
                                            <div class="col-span-6 flex items-center gap-3">
                                                <div
                                                    class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 text-xs font-bold">
                                                    <span
                                                        x-text="c.original_filename.substring(0,2).toUpperCase()"></span>
                                                </div>
                                                <div class="truncate">
                                                    <p class="text-sm font-medium text-slate-900 truncate"
                                                        x-text="c.original_filename"></p>
                                                    <p x-show="c.status === 'FAILED' && c.error_message"
                                                        class="text-xs text-red-600 truncate mt-0.5"
                                                        x-text="c.error_message"></p>
                                                </div>
                                            </div>
                                            <div class="col-span-2 flex items-center gap-2">
                                                <!-- Mobile: Show only colored circle -->
                                                <span class="md:hidden w-3 h-3 rounded-full"
                                                    :class="{
                                                        'bg-slate-400': c.status === 'UPLOADED',
                                                        'bg-blue-500': c.status === 'PROCESSING',
                                                        'bg-purple-500': c.status === 'PARSED',
                                                        'bg-green-500': c.status === 'SCORED',
                                                        'bg-red-500': c.status === 'FAILED'
                                                    }"
                                                    :title="c.status">
                                                </span>
                                                <!-- Desktop: Show full badge with text -->
                                                <span
                                                    class="hidden md:inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                                    :class="{
                                                    'bg-slate-100 text-slate-800': c.status === 'UPLOADED',
                                                    'bg-blue-50 text-blue-700': c.status === 'PROCESSING',
                                                    'bg-purple-50 text-purple-700': c.status === 'PARSED',
                                                    'bg-green-50 text-green-700': c.status === 'SCORED',
                                                    'bg-red-50 text-red-700': c.status === 'FAILED'
                                                }">
                                                    <span class="w-1.5 h-1.5 rounded-full mr-1.5" :class="{
                                                        'bg-slate-400': c.status === 'UPLOADED',
                                                        'bg-blue-500': c.status === 'PROCESSING',
                                                        'bg-purple-500': c.status === 'PARSED',
                                                        'bg-green-500': c.status === 'SCORED',
                                                        'bg-red-500': c.status === 'FAILED'
                                                    }"></span>
                                                    <span x-text="c.status"></span>
                                                </span>
                                            </div>
                                            <div class="col-span-2 text-right text-xs text-slate-400">
                                                <span x-text="new Date(c.created_at).toLocaleDateString()"></span>
                                            </div>
                                            <div class="col-span-1 flex items-center justify-center relative">
                                                <button @click="menuOpen = !menuOpen" @click.away="menuOpen = false"
                                                    class="p-1 hover:bg-slate-200 rounded text-slate-400 hover:text-slate-600 transition-colors">
                                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                        <path
                                                            d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z">
                                                        </path>
                                                    </svg>
                                                </button>
                                                <div x-show="menuOpen" x-transition
                                                    class="absolute right-0 top-8 w-48 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-10">
                                                    <button @click="viewCandidateDetails(c); menuOpen = false"
                                                        class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
                                                            </path>
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                                            </path>
                                                        </svg>
                                                        View Analysis
                                                    </button>
                                                    <button @click="viewContactInfo(c); menuOpen = false"
                                                        class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                                            </path>
                                                        </svg>
                                                        View Contact
                                                    </button>
                                                    <button @click="downloadFile(c); menuOpen = false"
                                                        class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4">
                                                            </path>
                                                        </svg>
                                                        Download File
                                                    </button>
                                                    <div class="border-t border-slate-200 my-1"></div>
                                                    <button @click="deleteSingleCandidate(c); menuOpen = false"
                                                        class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                                            </path>
                                                        </svg>
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Legal Disclaimer Footer -->
                                    <div class="mt-4 pt-4 border-t border-slate-200">
                                        <div class="bg-slate-50 rounded-lg px-4 py-3 border border-slate-200">
                                            <p class="text-xs text-slate-600 text-center">
                                                AI scores are decision-support tools only. Final hiring decisions require human review per employment law.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="candidateDetail.visible" class="fixed inset-0 z-50 overflow-y-auto" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="candidateDetail.visible" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="candidateDetail.visible = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="candidateDetail.visible" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl w-full">
                        <div class="bg-white px-6 pt-6 pb-4">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-12 h-12 rounded-full bg-brand-100 flex items-center justify-center text-brand-600 text-lg font-bold">
                                        <span
                                            x-text="candidateDetail.data?.original_filename?.substring(0,2).toUpperCase()"></span>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-semibold text-slate-900"
                                            x-text="candidateDetail.data?.original_filename"></h3>
                                        <p class="text-sm text-slate-500"
                                            x-text="'Uploaded ' + new Date(candidateDetail.data?.created_at).toLocaleDateString()">
                                        </p>
                                    </div>
                                </div>
                                <button @click="candidateDetail.visible = false"
                                    class="text-slate-400 hover:text-slate-500">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <template x-if="candidateDetail.data?.score">
                                <div class="bg-slate-50 rounded-lg p-4 mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-sm font-medium text-slate-700">Relevance Indicator</span>
                                        <span class="text-3xl font-bold text-brand-600"
                                            x-text="candidateDetail.data.score.toFixed(1)"></span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-2">
                                        <div class="bg-brand-600 h-2 rounded-full transition-all"
                                            :style="`width: ${candidateDetail.data.score}%`"></div>
                                    </div>
                                </div>
                            </template>

                            <template x-if="candidateDetail.evaluation">
                                <div class="space-y-4">
                                    <div>
                                        <h4 class="text-sm font-semibold text-slate-900 mb-2">Summary</h4>
                                        <p class="text-sm text-slate-600" x-text="candidateDetail.evaluation.summary">
                                        </p>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <h4
                                                class="text-sm font-semibold text-green-900 mb-2 flex items-center gap-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                Strengths
                                            </h4>
                                            <ul class="space-y-1">
                                                <template x-for="pro in candidateDetail.evaluation.pros" :key="pro">
                                                    <li class="text-sm text-slate-600 flex items-start gap-2">
                                                        <span class="text-green-500 mt-0.5">•</span>
                                                        <span x-text="pro"></span>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>

                                        <div>
                                            <h4
                                                class="text-sm font-semibold text-orange-900 mb-2 flex items-center gap-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                                                    </path>
                                                </svg>
                                                Areas for Consideration
                                            </h4>
                                            <ul class="space-y-1">
                                                <template x-for="con in candidateDetail.evaluation.cons" :key="con">
                                                    <li class="text-sm text-slate-600 flex items-start gap-2">
                                                        <span class="text-orange-500 mt-0.5">•</span>
                                                        <span x-text="con"></span>
                                                    </li>
                                                </template>
                                            </ul>
                                        </div>
                                    </div>

                                    <div
                                        x-show="Object.keys(candidateDetail.evaluation.category_scores || {}).length > 0">
                                        <h4 class="text-sm font-semibold text-slate-900 mb-3">
                                            Category Scores
                                            <span class="text-xs font-normal text-slate-500 ml-2">(with AI
                                                reasoning)</span>
                                        </h4>
                                        <div class="space-y-3">
                                            <template
                                                x-for="[category, data] in Object.entries(candidateDetail.evaluation.category_scores || {})"
                                                :key="category">
                                                <div class="bg-slate-50 rounded-lg p-3 border border-slate-100">
                                                    <div class="flex justify-between items-center mb-2">
                                                        <span class="text-sm font-semibold text-slate-800"
                                                            x-text="category"></span>
                                                        <span class="text-lg font-bold text-brand-600"
                                                            x-text="typeof data === 'object' ? data.score.toFixed(1) : data.toFixed(1)"></span>
                                                    </div>
                                                    <div class="w-full bg-slate-200 rounded-full h-2 mb-2">
                                                        <div class="bg-brand-500 h-2 rounded-full transition-all"
                                                            :style="`width: ${typeof data === 'object' ? data.score : data}%`">
                                                        </div>
                                                    </div>
                                                    <p x-show="typeof data === 'object' && data.reasoning"
                                                        class="text-xs text-slate-600 leading-relaxed"
                                                        x-text="data.reasoning"></p>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <template x-if="!candidateDetail.evaluation && candidateDetail.data?.status === 'SCORED'">
                                <div class="text-center py-8 text-slate-400">Loading evaluation...</div>
                            </template>

                            <template x-if="candidateDetail.data?.status !== 'SCORED'">
                                <div class="text-center py-8">
                                    <div class="text-slate-400 text-sm"
                                        x-text="`Status: ${candidateDetail.data?.status}`"></div>
                                    <p class="text-slate-500 text-sm mt-2">This candidate has not been scored yet.</p>
                                </div>
                            </template>
                        </div>

                        <div class="bg-slate-50 px-6 py-4 flex justify-between gap-3">
                            <button @click="viewContactInfo(candidateDetail.data)"
                                class="px-4 py-2 bg-white border border-slate-300 rounded-lg text-sm font-medium text-slate-700 hover:bg-slate-50 inline-flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                View Contact
                            </button>
                            <div class="flex gap-3">
                                <button @click="downloadFile(candidateDetail.data)"
                                    class="px-4 py-2 bg-white border border-slate-300 rounded-lg text-sm font-medium text-slate-700 hover:bg-slate-50">
                                    Download Resume
                                </button>
                                <button @click="candidateDetail.visible = false"
                                    class="px-4 py-2 bg-brand-600 rounded-lg text-sm font-medium text-white hover:bg-brand-700">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="showCreateModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title"
                role="dialog" aria-modal="true" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="showCreateModal" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="showCreateModal = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="showCreateModal" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <h3 class="text-lg leading-6 font-medium text-slate-900" id="modal-title">Create New
                                Position</h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700">Job Title</label>
                                    <input type="text" x-model="newJob.title"
                                        class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 sm:text-sm p-2 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700">Description</label>
                                    <textarea x-model="newJob.description" rows="4" maxlength="15000"
                                        class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 sm:text-sm p-2 border"
                                        :class="{'border-red-500': newJob.description && newJob.description.length > 15000}"></textarea>
                                    <p class="mt-1 text-xs text-slate-500">
                                        Paste the full job description here.
                                        <span :class="{'text-red-600 font-semibold': newJob.description && newJob.description.length > 15000}">
                                            <span x-text="(newJob.description || '').length"></span>/15,000 characters
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" @click="createJob()" :disabled="isCreating"
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-600 text-base font-medium text-white hover:bg-brand-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50">
                                <span x-show="!isCreating">Create Position</span>
                                <span x-show="isCreating">Creating...</span>
                            </button>
                            <button type="button" @click="showCreateModal = false"
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="showEditJobModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="edit-modal-title"
                role="dialog" aria-modal="true" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="showEditJobModal" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="showEditJobModal = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="showEditJobModal" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <h3 class="text-lg leading-6 font-medium text-slate-900" id="edit-modal-title">Edit Position
                            </h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700">Job Title</label>
                                    <input type="text" x-model="editJobData.title"
                                        class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 sm:text-sm p-2 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700">Description</label>
                                    <textarea x-model="editJobData.description" rows="4" maxlength="15000"
                                        class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 sm:text-sm p-2 border"
                                        :class="{'border-red-500': editJobData.description && editJobData.description.length > 15000}"></textarea>
                                    <p class="mt-1 text-xs text-slate-500">
                                        <span :class="{'text-red-600 font-semibold': editJobData.description && editJobData.description.length > 15000}">
                                            <span x-text="(editJobData.description || '').length"></span>/15,000 characters
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" @click="saveJobEdit()" :disabled="isEditing"
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-brand-600 text-base font-medium text-white hover:bg-brand-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50">
                                <span x-show="!isEditing">Save Changes</span>
                                <span x-show="isEditing">Saving...</span>
                            </button>
                            <button type="button" @click="showEditJobModal = false"
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View Job Description Modal -->
            <div x-show="viewJobDescriptionModal.visible" class="fixed inset-0 z-50 overflow-y-auto"
                aria-labelledby="view-description-modal-title" role="dialog" aria-modal="true" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="viewJobDescriptionModal.visible" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="viewJobDescriptionModal.visible = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="viewJobDescriptionModal.visible" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl w-full">
                        <div class="bg-white px-6 pt-6 pb-4">
                            <div class="flex items-start justify-between mb-4">
                                <h3 class="text-xl font-semibold text-slate-900" id="view-description-modal-title"
                                    x-text="viewJobDescriptionModal.job?.title"></h3>
                                <button @click="viewJobDescriptionModal.visible = false"
                                    class="text-slate-400 hover:text-slate-500">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="mt-4">
                                <h4 class="text-sm font-semibold text-slate-700 mb-2">Job Description</h4>
                                <div class="bg-slate-50 rounded-lg p-4 max-h-96 overflow-y-auto">
                                    <p class="text-sm text-slate-600 whitespace-pre-wrap"
                                        x-text="viewJobDescriptionModal.job?.description"></p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-50 px-6 py-4 flex justify-end">
                            <button @click="viewJobDescriptionModal.visible = false"
                                class="px-4 py-2 bg-brand-600 rounded-lg text-sm font-medium text-white hover:bg-brand-700">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="deleteJobConfirm.visible" class="fixed inset-0 z-50 overflow-y-auto"
                aria-labelledby="delete-job-modal-title" role="dialog" aria-modal="true" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="deleteJobConfirm.visible" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="deleteJobConfirm.visible = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="deleteJobConfirm.visible" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div
                                    class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                                    <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                </div>
                                <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                    <h3 class="text-lg leading-6 font-medium text-slate-900"
                                        id="delete-job-modal-title">Delete Position</h3>
                                    <div class="mt-2">
                                        <p class="text-sm text-slate-500">
                                            Are you sure you want to delete
                                            <span class="font-semibold text-slate-900"
                                                x-text="deleteJobConfirm.job?.title"></span>?
                                            This will also delete all associated candidates and their files. This action
                                            cannot be undone.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" @click="confirmJobDelete()"
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                                Delete
                            </button>
                            <button type="button" @click="deleteJobConfirm.visible = false"
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="deleteConfirm.visible" class="fixed inset-0 z-50 overflow-y-auto"
                aria-labelledby="delete-modal-title" role="dialog" aria-modal="true" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="deleteConfirm.visible" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity" @click="cancelDelete()">
                    </div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="deleteConfirm.visible" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div
                                    class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                                    <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                </div>
                                <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                    <h3 class="text-lg leading-6 font-medium text-slate-900" id="delete-modal-title">
                                        <span
                                            x-text="deleteConfirm.candidates.length === 1 ? 'Remove Candidate' : 'Remove Candidates'"></span>
                                    </h3>
                                    <div class="mt-2">
                                        <p class="text-sm text-slate-500">
                                            Are you sure you want to remove
                                            <span x-show="deleteConfirm.candidates.length === 1"
                                                class="font-semibold text-slate-900"
                                                x-text="deleteConfirm.candidates[0]?.original_filename"></span>
                                            <span x-show="deleteConfirm.candidates.length > 1"
                                                class="font-semibold text-slate-900"><span
                                                    x-text="deleteConfirm.candidates.length"></span> candidates</span>?
                                            This action cannot be undone.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                            <button type="button" @click="confirmDelete()"
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
                                Remove
                            </button>
                            <button type="button" @click="cancelDelete()"
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="contactInfo.visible" class="fixed inset-0 z-50 overflow-y-auto"
                aria-labelledby="contact-modal-title" role="dialog" aria-modal="true" x-cloak>
                <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                    <div x-show="contactInfo.visible" x-transition.opacity
                        class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="contactInfo.visible = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="contactInfo.visible" x-transition.scale
                        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md w-full">
                        <div class="bg-white px-6 pt-6 pb-4">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-12 h-12 rounded-full bg-brand-100 flex items-center justify-center text-brand-600">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-semibold text-slate-900" id="contact-modal-title">
                                            Contact Information</h3>
                                        <p class="text-sm text-slate-500"
                                            x-text="contactInfo.candidate?.original_filename"></p>
                                    </div>
                                </div>
                                <button @click="contactInfo.visible = false"
                                    class="text-slate-400 hover:text-slate-500">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <template
                                x-if="contactInfo.candidate?.first_name || contactInfo.candidate?.last_name || contactInfo.candidate?.email">
                                <div class="space-y-4">
                                    <template
                                        x-if="contactInfo.candidate?.first_name || contactInfo.candidate?.last_name">
                                        <div class="bg-slate-50 rounded-lg p-4">
                                            <label
                                                class="text-xs font-semibold text-slate-500 uppercase tracking-wider block mb-1">Full
                                                Name</label>
                                            <p class="text-base font-medium text-slate-900">
                                                <span x-text="contactInfo.candidate?.first_name || ''"></span>
                                                <span x-text="contactInfo.candidate?.last_name || ''"></span>
                                            </p>
                                        </div>
                                    </template>

                                    <template x-if="contactInfo.candidate?.email">
                                        <div class="bg-slate-50 rounded-lg p-4">
                                            <label
                                                class="text-xs font-semibold text-slate-500 uppercase tracking-wider block mb-1">Email
                                                Address</label>
                                            <a :href="'mailto:' + contactInfo.candidate?.email"
                                                class="text-base font-medium text-brand-600 hover:text-brand-700 flex items-center gap-2">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                                                    </path>
                                                </svg>
                                                <span x-text="contactInfo.candidate?.email"></span>
                                            </a>
                                        </div>
                                    </template>

                                    <template x-if="contactInfo.candidate?.phone">
                                        <div class="bg-slate-50 rounded-lg p-4">
                                            <label
                                                class="text-xs font-semibold text-slate-500 uppercase tracking-wider block mb-1">Phone
                                                Number</label>
                                            <div class="flex items-center gap-2 text-base font-medium text-slate-900">
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                                                    </path>
                                                </svg>
                                                <span x-text="contactInfo.candidate?.phone"></span>
                                            </div>
                                        </div>
                                    </template>

                                    <template x-if="contactInfo.candidate?.location">
                                        <div class="bg-slate-50 rounded-lg p-4">
                                            <label
                                                class="text-xs font-semibold text-slate-500 uppercase tracking-wider block mb-1">Location</label>
                                            <div class="flex items-center gap-2 text-base font-medium text-slate-900">
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                                                    </path>
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                </svg>
                                                <span x-text="contactInfo.candidate?.location"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>

                            <!-- Web Presence Section -->
                            <template x-if="contactInfo.candidate?.linkedin_url || contactInfo.candidate?.github_url || contactInfo.candidate?.portfolio_url || (contactInfo.candidate?.other_urls && contactInfo.candidate?.other_urls.length > 0)">
                                <div class="mt-6 pt-6 border-t border-slate-200">
                                    <h4 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">Web Presence</h4>
                                    <div class="space-y-3">
                                        <template x-if="contactInfo.candidate?.linkedin_url">
                                            <a :href="contactInfo.candidate.linkedin_url.startsWith('http') ? contactInfo.candidate.linkedin_url : 'https://' + contactInfo.candidate.linkedin_url" target="_blank" class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors border border-blue-100">
                                                <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                                </svg>
                                                <span class="text-sm font-medium text-blue-900">LinkedIn Profile</span>
                                            </a>
                                        </template>

                                        <template x-if="contactInfo.candidate?.github_url">
                                            <a :href="contactInfo.candidate.github_url.startsWith('http') ? contactInfo.candidate.github_url : 'https://' + contactInfo.candidate.github_url" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors border border-slate-200">
                                                <svg class="w-5 h-5 text-slate-700" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                                </svg>
                                                <span class="text-sm font-medium text-slate-700">GitHub Profile</span>
                                            </a>
                                        </template>

                                        <template x-if="contactInfo.candidate?.portfolio_url">
                                            <a :href="contactInfo.candidate.portfolio_url.startsWith('http') ? contactInfo.candidate.portfolio_url : 'https://' + contactInfo.candidate.portfolio_url" target="_blank" class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors border border-purple-100">
                                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                                                </svg>
                                                <span class="text-sm font-medium text-purple-900">Portfolio Website</span>
                                            </a>
                                        </template>

                                        <template x-if="contactInfo.candidate?.other_urls && contactInfo.candidate?.other_urls.length > 0">
                                            <div class="pt-2 mt-2 border-t border-slate-100">
                                                <template x-for="url in contactInfo.candidate.other_urls" :key="url">
                                                    <a :href="url.startsWith('http') ? url : 'https://' + url" target="_blank" class="flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-brand-600 hover:underline mb-1">
                                                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                                        </svg>
                                                        <span x-text="url.replace(/^https?:\/\//, '').replace(/^www\./, '').substring(0, 40) + (url.length > 40 ? '...' : '')"></span>
                                                    </a>
                                                </template>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>

                            <template
                                x-if="!contactInfo.candidate?.first_name && !contactInfo.candidate?.last_name && !contactInfo.candidate?.email && !contactInfo.candidate?.phone && !contactInfo.candidate?.location">
                                <div class="text-center py-8">
                                    <div
                                        class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <h4 class="text-sm font-medium text-slate-900 mb-1">No Contact Information</h4>
                                    <p class="text-sm text-slate-500">This resume was uploaded with blind screening
                                        enabled. Contact details are not available.</p>
                                </div>
                            </template>
                        </div>

                        <div class="bg-slate-50 px-6 py-4 flex justify-end gap-3">
                            <template x-if="contactInfo.candidate?.email">
                                <a :href="'mailto:' + contactInfo.candidate?.email"
                                    class="px-4 py-2 bg-brand-600 rounded-lg text-sm font-medium text-white hover:bg-brand-700 inline-flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    Send Email
                                </a>
                            </template>
                            <button @click="contactInfo.visible = false"
                                class="px-4 py-2 bg-white border border-slate-300 rounded-lg text-sm font-medium text-slate-700 hover:bg-slate-50">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upgrade Modal (Payment Required) -->
            <div x-show="upgradeModal.visible" x-cloak
                class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                    <!-- Background overlay -->
                    <div x-show="upgradeModal.visible" x-transition:enter="ease-out duration-300"
                        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
                        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100"
                        x-transition:leave-end="opacity-0" class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity"
                        @click="upgradeModal.visible = false" aria-hidden="true">
                    </div>

                    <!-- Modal panel -->
                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                    <div x-show="upgradeModal.visible" x-transition:enter="ease-out duration-300"
                        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                        x-transition:leave="ease-in duration-200"
                        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                        class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">

                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 sm:mx-0 sm:h-10 sm:w-10">
                                <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1">
                                <h3 class="text-lg leading-6 font-medium text-slate-900" id="modal-title">
                                    Monthly Limit Reached
                                </h3>
                                <div class="mt-2">
                                    <p class="text-sm text-slate-500" x-text="upgradeModal.message">
                                    </p>
                                    <div class="mt-4 bg-slate-50 rounded-lg p-4 border border-slate-200">
                                        <p class="text-sm font-medium text-slate-700 mb-2">Upgrade to continue screening:</p>
                                        <ul class="space-y-2 text-sm text-slate-600">
                                            <li class="flex items-start gap-2">
                                                <svg class="w-5 h-5 text-brand-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span><strong>Recruiter Plan:</strong> $20/mo - 100 candidates</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <svg class="w-5 h-5 text-brand-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span><strong>Small Business:</strong> $149/mo - 1,000 candidates</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <svg class="w-5 h-5 text-brand-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span><strong>Enterprise:</strong> $499/mo - 5,000 candidates</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse gap-3">
                            <a href="/static/pricing.html"
                                class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-brand-600 text-base font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 sm:ml-3 sm:w-auto sm:text-sm transition">
                                View Plans
                            </a>
                            <button type="button" @click="upgradeModal.visible = false"
                                class="mt-3 w-full inline-flex justify-center rounded-lg border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 sm:mt-0 sm:w-auto sm:text-sm transition">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <script>
            const API_BASE = '/api/v1';

            // Global modal state management - Initialize immediately
            let modalState = {
                deleteAccountModal: {
                    show: false,
                    step: 1,
                    confirmText: '',
                    error: '',
                    loading: false
                },
                cancelSubModal: {
                    show: false,
                    message: '',
                    planDisplay: '',
                    loading: false
                },
                toast: {
                    show: false,
                    type: 'success',
                    title: '',
                    message: ''
                }
            };

            /**
             * Confirmation Modals Component
             */
            function confirmationModals() {
                // Return the already-initialized global state
                return modalState;
            }

            /**
             * Show toast notification
             */
            function showToast(type, title, message) {
                if (modalState) {
                    modalState.toast = {
                        show: true,
                        type,
                        title,
                        message
                    };
                    setTimeout(() => {
                        if (modalState) modalState.toast.show = false;
                    }, 5000);
                }
            }

            /**
             * Delete the current user's account
             * Opens modal confirmation dialog
             */
            function deleteAccount() {
                if (modalState) {
                    modalState.deleteAccountModal = {
                        show: true,
                        step: 1,
                        confirmText: '',
                        error: '',
                        loading: false
                    };
                }
            }

            /**
             * Cancel delete account process
             */
            function cancelDeleteAccount() {
                if (modalState) {
                    modalState.deleteAccountModal.show = false;
                    modalState.deleteAccountModal.step = 1;
                    modalState.deleteAccountModal.confirmText = '';
                    modalState.deleteAccountModal.error = '';
                }
            }

            /**
             * Confirm and execute account deletion
             */
            async function confirmDeleteAccount() {
                if (!modalState) return;

                const modal = modalState.deleteAccountModal;

                if (modal.confirmText !== 'YES') {
                    modal.error = 'You must type "YES" exactly to confirm.';
                    return;
                }

                modal.loading = true;
                modal.error = '';

                try {
                    console.log('[DeleteAccount] Sending delete request...');

                    const response = await Auth.fetch(`${API_BASE}/auth/me`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('[DeleteAccount] Account deleted successfully:', data);

                        // Hide modal
                        modal.show = false;

                        // Show success toast
                        showToast(
                            'success',
                            'Account Deleted Successfully',
                            (data.stripe_subscription_canceled
                                ? '• Your Stripe subscription has been canceled<br>'
                                : '• No active subscription to cancel<br>') +
                            '• All your data has been deleted<br><br>' +
                            'You will now be redirected to the login page.'
                        );

                        // Clear auth tokens and redirect after delay
                        setTimeout(() => {
                            Auth.logout();
                        }, 3000);
                    } else {
                        const errorData = await response.json().catch(() => ({ detail: 'Unknown error' }));
                        console.error('[DeleteAccount] Failed to delete account:', errorData);
                        modal.error = errorData.detail || 'Failed to delete account';
                        modal.loading = false;
                    }
                } catch (error) {
                    console.error('[DeleteAccount] Error:', error);
                    modal.error = error.message || 'An error occurred';
                    modal.loading = false;
                }
            }

            /**
             * Confirm and execute subscription cancellation
             */
            async function confirmCancelSubscription() {
                if (!modalState) return;

                const modal = modalState.cancelSubModal;
                modal.loading = true;

                try {
                    const response = await Auth.fetch(`${API_BASE}/subscriptions/cancel`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();

                        // Hide modal
                        modal.show = false;
                        modal.loading = false;

                        // Show success toast
                        showToast(
                            'success',
                            'Subscription Canceled Successfully',
                            `${data.message}<br><br>You'll be downgraded to the Free plan when your current period ends.`
                        );

                        // Reload page to reflect changes
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        const errorData = await response.json();
                        modal.show = false;
                        modal.loading = false;

                        showToast(
                            'error',
                            'Failed to Cancel Subscription',
                            errorData.detail || 'Unknown error'
                        );
                    }
                } catch (error) {
                    console.error('Error canceling subscription:', error);
                    modal.show = false;
                    modal.loading = false;

                    showToast(
                        'error',
                        'Error Canceling Subscription',
                        error.message
                    );
                }
            }

            // Subscription status component
            function subscriptionStatus() {
                return {
                    subscription: null,
                    loading: false,

                    async loadSubscription() {
                        this.loading = true;
                        try {
                            const response = await Auth.fetch(`${API_BASE}/subscriptions/current`);
                            if (response.ok) {
                                const data = await response.json();

                                // Add display name based on plan
                                // The API now returns plan_display directly, but keep fallback for backwards compatibility
                                const planDisplayNames = {
                                    'free': 'Free',
                                    'recruiter': 'Recruiter',
                                    'small_business': 'Small Business',
                                    'professional': 'Enterprise',
                                    'enterprise': 'Enterprise'
                                };

                                this.subscription = {
                                    ...data,
                                    plan_display: data.plan_display || planDisplayNames[data.plan] || data.plan.toUpperCase()
                                };

                                console.log('Subscription loaded:', this.subscription);
                            } else {
                                console.error('Failed to load subscription:', response.status);
                            }
                        } catch (error) {
                            console.error('Error loading subscription:', error);
                        } finally {
                            this.loading = false;
                        }
                    },

                    cancelSubscription() {
                        // Show modal confirmation
                        if (modalState) {
                            const message = `Are you sure you want to cancel your <strong>${this.subscription.plan_display}</strong> subscription?<br><br>` +
                                `Your subscription will remain active until the end of your billing period, then you'll be downgraded to the <strong>Free plan</strong> (10 candidates/month).`;

                            modalState.cancelSubModal = {
                                show: true,
                                message: message,
                                planDisplay: this.subscription.plan_display,
                                loading: false
                            };
                        }
                    },

                    deleteAccount() {
                        if (modalState) {
                            modalState.deleteAccountModal = {
                                show: true,
                                step: 1,
                                confirmText: '',
                                error: '',
                                loading: false
                            };
                        }
                    }
                };
            }

            function app() {
                return {
                    jobs: [],
                    candidates: [],
                    selectedJob: null,
                    showCreateModal: false,
                    showEditJobModal: false,
                    isCreating: false,
                    isEditing: false,
                    newJob: { title: '', description: '' },
                    editJobData: { id: null, title: '', description: '' },
                    toast: { visible: false, message: '', type: 'info' },
                    refreshInterval: null,
                    jobRefreshInterval: null,
                    deleteConfirm: { visible: false, candidates: [] },
                    deleteJobConfirm: { visible: false, job: null },
                    selectedCandidates: [],
                    candidateDetail: { visible: false, data: null, evaluation: null },
                    contactInfo: { visible: false, candidate: null },
                    viewJobDescriptionModal: { visible: false, job: null },
                    upgradeModal: { visible: false, message: '' },
                    openJobMenuId: null,

                    init() {
                        // Show page now that auth check passed and Alpine is ready
                        document.body.classList.remove('auth-checking');

                        this.loadJobs();
                        // Auto-refresh jobs every 3 seconds to update status badges
                        this.jobRefreshInterval = setInterval(() => this.loadJobs(), 3000);
                    },

                    showToast(msg, type = 'info') {
                        this.toast = { visible: true, message: msg, type };
                        setTimeout(() => this.toast.visible = false, 3000);
                    },

                    async loadJobs() {
                        try {
                            const res = await Auth.fetch(`${API_BASE}/jobs/`);
                            this.jobs = await res.json();
                            // Sort by ID desc
                            this.jobs.sort((a, b) => b.id - a.id);
                        } catch (e) {
                            this.showToast('Failed to load jobs', 'error');
                        }
                    },

                    async createJob() {
                        if (!this.newJob.title || !this.newJob.description) return;
                        this.isCreating = true;
                        try {
                            const res = await Auth.fetch(`${API_BASE}/jobs/`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(this.newJob)
                            });
                            if (res.ok) {
                                await this.loadJobs();
                                this.showCreateModal = false;
                                this.newJob = { title: '', description: '' };
                                this.showToast('Position created successfully', 'success');
                            }
                        } catch (e) {
                            this.showToast('Error creating job', 'error');
                        } finally {
                            this.isCreating = false;
                        }
                    },

                    viewJobDescription(job) {
                        this.viewJobDescriptionModal = { visible: true, job: job };
                    },

                    editJob(job) {
                        this.editJobData = {
                            id: job.id,
                            title: job.title,
                            description: job.description
                        };
                        this.showEditJobModal = true;
                    },

                    async saveJobEdit() {
                        if (!this.editJobData.title || !this.editJobData.description) return;
                        this.isEditing = true;
                        try {
                            const res = await Auth.fetch(`${API_BASE}/jobs/${this.editJobData.id}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    title: this.editJobData.title,
                                    description: this.editJobData.description
                                })
                            });
                            if (res.ok) {
                                const updatedJob = await res.json();
                                await this.loadJobs();
                                // Update selectedJob if it's the one being edited
                                if (this.selectedJob && this.selectedJob.id === this.editJobData.id) {
                                    this.selectedJob = updatedJob;
                                }
                                this.showEditJobModal = false;
                                this.showToast('Position updated successfully', 'success');
                            }
                        } catch (e) {
                            this.showToast('Error updating job', 'error');
                        } finally {
                            this.isEditing = false;
                        }
                    },

                    openDeleteJobModal(job) {
                        this.deleteJobConfirm = { visible: true, job: job };
                    },

                    async confirmJobDelete() {
                        const jobId = this.deleteJobConfirm.job.id;
                        try {
                            const res = await Auth.fetch(`${API_BASE}/jobs/${jobId}`, {
                                method: 'DELETE'
                            });
                            if (res.ok) {
                                // Clear selection if deleting the selected job
                                if (this.selectedJob && this.selectedJob.id === jobId) {
                                    this.selectedJob = null;
                                    this.candidates = [];
                                    if (this.refreshInterval) {
                                        clearInterval(this.refreshInterval);
                                        this.refreshInterval = null;
                                    }
                                }
                                await this.loadJobs();
                                this.showToast('Position deleted successfully', 'success');
                            } else {
                                // Handle non-ok responses (404, 500, etc.)
                                const error = await res.text();
                                console.error('Delete failed:', error);
                                this.showToast('Failed to delete position', 'error');
                            }
                        } catch (e) {
                            console.error('Delete error:', e);
                            this.showToast('Error deleting job', 'error');
                        } finally {
                            // Always close the modal, even on error
                            this.deleteJobConfirm = { visible: false, job: null };
                        }
                    },

                    selectJob(job) {
                        this.selectedJob = job;
                        this.selectedCandidates = [];
                        this.loadCandidates();

                        if (this.refreshInterval) clearInterval(this.refreshInterval);
                        this.refreshInterval = setInterval(() => this.loadCandidates(), 3000);
                    },

                    async loadCandidates() {
                        if (!this.selectedJob) return;
                        try {
                            const res = await Auth.fetch(`${API_BASE}/jobs/${this.selectedJob.id}/candidates/`);
                            this.candidates = await res.json();
                            // Sort by score (highest first), then by ID (newest first)
                            this.candidates.sort((a, b) => {
                                // If both have scores, sort by score descending (highest first)
                                if (a.score !== null && b.score !== null) {
                                    return b.score - a.score;
                                }
                                // If only one has a score, prioritize the one with score
                                if (a.score !== null) return -1;
                                if (b.score !== null) return 1;
                                // If neither has score, sort by ID descending (newest first)
                                return b.id - a.id;
                            });
                            // Remove deleted candidates from selection
                            const candidateIds = this.candidates.map(c => c.id);
                            this.selectedCandidates = this.selectedCandidates.filter(id => candidateIds.includes(id));
                        } catch (e) {
                            console.error(e);
                        }
                    },

                    toggleSelectAll(event) {
                        if (event.target.checked) {
                            this.selectedCandidates = this.candidates.map(c => c.id);
                        } else {
                            this.selectedCandidates = [];
                        }
                    },

                    toggleCandidate(candidateId) {
                        const index = this.selectedCandidates.indexOf(candidateId);
                        if (index > -1) {
                            this.selectedCandidates.splice(index, 1);
                        } else {
                            this.selectedCandidates.push(candidateId);
                        }
                    },

                    deleteSelectedCandidates() {
                        const selectedCandidateObjs = this.candidates.filter(c => this.selectedCandidates.includes(c.id));
                        this.deleteConfirm = { visible: true, candidates: selectedCandidateObjs };
                    },

                    deleteSingleCandidate(candidate) {
                        this.deleteConfirm = { visible: true, candidates: [candidate] };
                    },

                    async uploadFile(event, type) {
                        if (!this.selectedJob) return;
                        const files = event.target.files;
                        if (!files || files.length === 0) return;

                        const endpoint = type === 'bulk' ? 'bulk-upload-zip' : 'upload';

                        // For bulk ZIP, process as before (single file)
                        if (type === 'bulk') {
                            const formData = new FormData();
                            formData.append('file', files[0]);
                            this.showToast('Processing ZIP...', 'info');

                            try {
                                const res = await Auth.fetch(`${API_BASE}/jobs/${this.selectedJob.id}/candidates/${endpoint}`, {
                                    method: 'POST',
                                    body: formData
                                });
                                if (res.ok) {
                                    this.showToast('Upload successful', 'success');
                                    this.loadCandidates();
                                } else if (res.status === 402) {
                                    // Payment required - show upgrade modal
                                    const errorData = await res.json().catch(() => ({}));
                                    this.upgradeModal = {
                                        visible: true,
                                        message: errorData.detail || 'You\'ve reached your monthly candidate limit. Upgrade to continue screening more candidates.'
                                    };
                                } else {
                                    // Get error message from response
                                    const errorData = await res.json().catch(() => ({}));
                                    const errorMsg = errorData.detail || 'Upload failed';
                                    this.showToast(errorMsg, 'error');
                                }
                            } catch (e) {
                                this.showToast('Upload error', 'error');
                            }
                        } else {
                            // For single uploads, handle multiple files
                            const fileCount = files.length;
                            this.showToast(`Uploading ${fileCount} resume${fileCount > 1 ? 's' : ''}...`, 'info');

                            let successCount = 0;
                            let failCount = 0;
                            let lastErrorMsg = null;

                            for (let i = 0; i < files.length; i++) {
                                const formData = new FormData();
                                formData.append('file', files[i]);

                                try {
                                    const res = await Auth.fetch(`${API_BASE}/jobs/${this.selectedJob.id}/candidates/${endpoint}`, {
                                        method: 'POST',
                                        body: formData
                                    });
                                    if (res.ok) {
                                        successCount++;
                                    } else {
                                        // Check for 402 Payment Required (limit reached)
                                        if (res.status === 402) {
                                            const errorData = await res.json().catch(() => ({}));
                                            this.upgradeModal = {
                                                visible: true,
                                                message: errorData.detail || 'You\'ve reached your monthly candidate limit. Upgrade to continue screening more candidates.'
                                            };
                                            // Stop processing remaining files
                                            break;
                                        }

                                        failCount++;
                                        // Capture error message from first failure
                                        if (!lastErrorMsg) {
                                            const errorData = await res.json().catch(() => ({}));
                                            lastErrorMsg = errorData.detail || 'Upload failed';
                                        }
                                    }
                                } catch (e) {
                                    failCount++;
                                }
                            }

                            // Show summary
                            if (failCount === 0) {
                                this.showToast(`${successCount} resume${successCount > 1 ? 's' : ''} uploaded successfully`, 'success');
                            } else if (successCount === 0) {
                                // Show specific error message if available
                                const errorMsg = lastErrorMsg || `Failed to upload ${failCount} resume${failCount > 1 ? 's' : ''}`;
                                this.showToast(errorMsg, 'error');
                            } else {
                                this.showToast(`${successCount} uploaded, ${failCount} failed`, 'info');
                            }

                            this.loadCandidates();
                        }

                        event.target.value = ''; // Reset input
                    },

                    async confirmDelete() {
                        if (!this.deleteConfirm.candidates || this.deleteConfirm.candidates.length === 0) return;

                        const candidates = this.deleteConfirm.candidates;
                        this.deleteConfirm = { visible: false, candidates: [] };

                        try {
                            // Delete all selected candidates
                            const deletePromises = candidates.map(candidate =>
                                Auth.fetch(`${API_BASE}/jobs/${this.selectedJob.id}/candidates/${candidate.id}`, {
                                    method: 'DELETE'
                                })
                            );

                            const results = await Promise.all(deletePromises);
                            const allSucceeded = results.every(res => res.ok);

                            if (allSucceeded) {
                                const count = candidates.length;
                                this.showToast(`${count} candidate${count > 1 ? 's' : ''} removed`, 'success');
                                this.selectedCandidates = [];
                                this.loadCandidates();
                            } else {
                                this.showToast('Some candidates failed to delete', 'error');
                                this.loadCandidates();
                            }
                        } catch (e) {
                            console.error('Delete candidates error:', e);
                            this.showToast('Error removing candidates', 'error');
                            this.loadCandidates(); // Refresh list even on error
                        }
                    },

                    cancelDelete() {
                        this.deleteConfirm = { visible: false, candidates: [] };
                    },

                    viewFailedFile(candidate) {
                        // Open the file in a new tab (browser will display or download based on file type)
                        const fileUrl = `${API_BASE}/jobs/${this.selectedJob.id}/candidates/${candidate.id}/file`;
                        window.open(fileUrl, '_blank');
                        this.showToast('Opening file...', 'info');
                    },

                    async viewCandidateDetails(candidate) {
                        this.candidateDetail = { visible: true, data: candidate, evaluation: null };

                        // If candidate is scored, fetch full evaluation details
                        if (candidate.status === 'SCORED') {
                            try {
                                const res = await Auth.fetch(`${API_BASE}/jobs/${this.selectedJob.id}/candidates/${candidate.id}`);
                                if (res.ok) {
                                    const fullData = await res.json();
                                    // Fetch evaluation separately if needed
                                    const evalRes = await Auth.fetch(`${API_BASE}/jobs/${this.selectedJob.id}/candidates/${candidate.id}/evaluation`);
                                    if (evalRes.ok) {
                                        this.candidateDetail.evaluation = await evalRes.json();
                                    }
                                }
                            } catch (e) {
                                console.error('Failed to load candidate details', e);
                            }
                        }
                    },

                    async downloadFile(candidate) {
                        try {
                            this.showToast('Downloading...', 'info');

                            const fileUrl = `${API_BASE}/jobs/${this.selectedJob.id}/candidates/${candidate.id}/file`;

                            // Fetch with authentication headers
                            const response = await Auth.fetch(fileUrl);

                            if (!response.ok) {
                                throw new Error('Failed to download file');
                            }

                            // Get the file as a blob
                            const blob = await response.blob();

                            // Create a download link with the blob
                            const blobUrl = window.URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = blobUrl;
                            link.download = candidate.original_filename;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);

                            // Clean up the blob URL
                            window.URL.revokeObjectURL(blobUrl);

                            this.showToast('Download complete', 'success');
                        } catch (error) {
                            console.error('Download failed:', error);
                            this.showToast('Failed to download file', 'error');
                        }
                    },

                    viewContactInfo(candidate) {
                        this.contactInfo = { visible: true, candidate: candidate };
                    }
                }
            }
        </script>

        <!-- Confirmation Modals -->
        <div x-data="confirmationModals()" x-cloak>
            <!-- Delete Account Modal -->
            <div x-show="deleteAccountModal.show"
                 class="fixed inset-0 z-50 overflow-y-auto"
                 @keydown.escape.window="deleteAccountModal.show = false">
                <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                    <!-- Background overlay -->
                    <div x-show="deleteAccountModal.show"
                         x-transition:enter="ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="ease-in duration-200"
                         x-transition:leave-start="opacity-100"
                         x-transition:leave-end="opacity-0"
                         class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"
                         @click="deleteAccountModal.show = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

                    <!-- Modal panel -->
                    <div x-show="deleteAccountModal.show"
                         x-transition:enter="ease-out duration-300"
                         x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                         x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                         x-transition:leave="ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                         x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                         class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">

                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1">
                                <!-- Step 1: Initial Confirmation -->
                                <div x-show="deleteAccountModal.step === 1">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900">Delete Account?</h3>
                                    <div class="mt-3">
                                        <p class="text-sm text-gray-500 mb-3">This action will:</p>
                                        <ul class="text-sm text-gray-700 space-y-2 list-disc pl-5">
                                            <li>Cancel your Stripe subscription (you won't be charged again)</li>
                                            <li>Delete ALL your data (jobs, candidates, evaluations)</li>
                                            <li><strong>This action is IRREVERSIBLE</strong></li>
                                        </ul>
                                        <p class="text-sm text-red-600 font-semibold mt-4">Are you absolutely sure you want to delete your account?</p>
                                    </div>
                                </div>

                                <!-- Step 2: Final Confirmation with Text Input -->
                                <div x-show="deleteAccountModal.step === 2">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900">Final Confirmation</h3>
                                    <div class="mt-3">
                                        <p class="text-sm text-gray-500 mb-3">To confirm account deletion, please type <span class="font-mono font-bold">YES</span> (in capital letters) below:</p>
                                        <input type="text"
                                               x-model="deleteAccountModal.confirmText"
                                               @keydown.enter="confirmDeleteAccount()"
                                               class="mt-2 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-brand-500 focus:border-brand-500 sm:text-sm"
                                               placeholder="Type YES to confirm">
                                        <p x-show="deleteAccountModal.error"
                                           class="mt-2 text-sm text-red-600"
                                           x-text="deleteAccountModal.error"></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                            <!-- Step 1 Buttons -->
                            <template x-if="deleteAccountModal.step === 1">
                                <div class="flex gap-3 w-full sm:w-auto">
                                    <button type="button"
                                            @click="deleteAccountModal.step = 2"
                                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                                        Yes, Continue
                                    </button>
                                    <button type="button"
                                            @click="cancelDeleteAccount()"
                                            class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 sm:w-auto sm:text-sm">
                                        Cancel
                                    </button>
                                </div>
                            </template>

                            <!-- Step 2 Buttons -->
                            <template x-if="deleteAccountModal.step === 2">
                                <div class="flex gap-3 w-full sm:w-auto">
                                    <button type="button"
                                            @click="confirmDeleteAccount()"
                                            :disabled="deleteAccountModal.loading"
                                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed sm:ml-3 sm:w-auto sm:text-sm">
                                        <span x-show="!deleteAccountModal.loading">Delete Account</span>
                                        <span x-show="deleteAccountModal.loading">Deleting...</span>
                                    </button>
                                    <button type="button"
                                            @click="deleteAccountModal.step = 1; deleteAccountModal.confirmText = ''; deleteAccountModal.error = ''"
                                            :disabled="deleteAccountModal.loading"
                                            class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed sm:w-auto sm:text-sm">
                                        Back
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cancel Subscription Modal -->
            <div x-show="cancelSubModal.show"
                 class="fixed inset-0 z-50 overflow-y-auto"
                 @keydown.escape.window="cancelSubModal.show = false">
                <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                    <!-- Background overlay -->
                    <div x-show="cancelSubModal.show"
                         x-transition:enter="ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="ease-in duration-200"
                         x-transition:leave-start="opacity-100"
                         x-transition:leave-end="opacity-0"
                         class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"
                         @click="cancelSubModal.show = false"></div>

                    <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

                    <!-- Modal panel -->
                    <div x-show="cancelSubModal.show"
                         x-transition:enter="ease-out duration-300"
                         x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                         x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                         x-transition:leave="ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                         x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                         class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">

                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10">
                                <svg class="h-6 w-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1">
                                <h3 class="text-lg leading-6 font-medium text-gray-900">Cancel Subscription?</h3>
                                <div class="mt-3">
                                    <p class="text-sm text-gray-500" x-html="cancelSubModal.message"></p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                            <button type="button"
                                    @click="confirmCancelSubscription()"
                                    :disabled="cancelSubModal.loading"
                                    class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-orange-600 text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed sm:ml-3 sm:w-auto sm:text-sm">
                                <span x-show="!cancelSubModal.loading">Yes, Cancel Subscription</span>
                                <span x-show="cancelSubModal.loading">Canceling...</span>
                            </button>
                            <button type="button"
                                    @click="cancelSubModal.show = false"
                                    :disabled="cancelSubModal.loading"
                                    class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed sm:mt-0 sm:w-auto sm:text-sm">
                                Keep Subscription
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Success/Error Toast -->
            <div x-show="toast.show"
                 x-transition:enter="transform ease-out duration-300 transition"
                 x-transition:enter-start="translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2"
                 x-transition:enter-end="translate-y-0 opacity-100 sm:translate-x-0"
                 x-transition:leave="transition ease-in duration-100"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 class="fixed top-4 right-4 z-50 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden">
                <div class="p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg x-show="toast.type === 'success'" class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <svg x-show="toast.type === 'error'" class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-3 w-0 flex-1 pt-0.5">
                            <p class="text-sm font-medium text-gray-900" x-text="toast.title"></p>
                            <p class="mt-1 text-sm text-gray-500" x-html="toast.message"></p>
                        </div>
                        <div class="ml-4 flex-shrink-0 flex">
                            <button @click="toast.show = false" class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500">
                                <span class="sr-only">Close</span>
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            [x-cloak] { display: none !important; }
        </style>
    </body>
</html>